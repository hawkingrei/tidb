# Proposal: Sync Load V2

- Author(s): [hawkingrei](https://github.com/hawkingrei)
- Tracking Issue: https://github.com/pingcap/tidb/issues/52831

##  Background 
Sync load first appeared starting from v5.4. But when we deal with Some customers' oncall, we find the metrics has too many 
timeouts on the sync load. It is odd. So we research through the implementation of sync load, identified many issues, and proposed an improvement plan.

## What is sync load

Sync load is to load stats that users use to query.  The trigger point for sync load is within logical optimization.
So that it can improve the completeness of statistics for SQL optimization. 

## Problem
1. sync load cannot set the upper limit to retry.
https://github.com/pingcap/tidb/issues/52657
https://github.com/pingcap/tidb/pull/52658

```SubLoadWorker``` will get the load task from the channel. Then start to load stats. But if HandleOneTaskreturn an error,
it will retry. But it has no limit on the retry. 

2. wrong implementation for singleflight 
In the old sync load , we don't use the Golang official singleflight and implement it by ourselves. It has a problem. 
In general, identical requests will be merged into a single request, and sent to the backend to avoid an excess of requests, 
and at the same time, all requests will be blocked to await the response. But in the old implementation, the same requests 
cannot wait and continue to optimize tasks. It will get pseudo statistics to make the unstable plan.
